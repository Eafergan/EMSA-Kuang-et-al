clear all;

NCM2SPS=[48.2571649900000,48.1909160900000,48.5062893100000,49.2709132800000;32.0032573300000,27.9969651000000,28.8994457600000,26.3241106700000;23.2538330500000,21.4748784400000,20.6477732800000,19.5299837900000;18.5089974300000,17.4708818600000,17.6470588200000,15.9183673500000;15.7847533600000,15.2100840300000,14.2491467600000,13.5961383700000;13.6162687900000,13.2264529100000,12.2536418200000,15.6704361900000;8.45188284500000,8.74097834800000,9.35720097600000,7.43827895500000];
NCM1SPS=[32.4554608800000,32.1785989200000,33.7264150900000,33.8449731400000;20.2768729600000,16.9954476500000,17.8147268400000,15.6521739100000;13.7989778500000,13.3711507300000,12.6315789500000,11.9935170200000;12.2536418200000,12.2296173000000,11.2605042000000,10.6122449000000;11.9282511200000,11.3445378200000,10.4948805500000,9.89541432000000;10.9637488900000,10.4208416800000,9.68294772900000,12.2778675300000;9.95815899600000,10.2646351200000,10.3336045600000,8.41470191300000];

NCM2CSL=[30.9672929700000,31.5719508100000,31.3030360200000,30.0907655900000;4.65820867300000,4.86564996400000,4.15218584200000,3.38076679100000;2.82651072100000,3.16608035500000,2.25124256900000,2.00653289800000;2.42699289700000,2.55979073200000,1.94986072400000,1.81479758000000;2.00731731400000,2.83740899800000,1.85141229500000,1.27077223900000;2.03383004400000,2.53116735900000,1.71139998100000,1.62586773800000;1.96078431400000,2.36013986000000,1.62281103900000,1.60766054600000];
NCM1CSL=[60.7167710500000,60.3190428700000,62.1346407700000,61.2667719000000;40.5226282900000,33.0428467700000,39.3268703100000,30.7260038100000;25.6335282700000,24.1621921900000,22.7073384700000,21.3485767600000;22.7900552500000,21.6741405100000,18.8486536700000,18.7994416000000;21.0619994100000,20.7205525500000,19.4635651600000,18.6705767400000;21.5465163100000,20.6837929700000,17.8621528100000,19.2729265600000;19.8827194400000,19.4930069900000,17.1449527800000,17.5700606200000];

H2SPS=[15.2636447700000,15.3776160100000,13.1459655500000,13.6206896600000;2.11864406800000,1.61490683200000,1.72136012900000,1.28371790700000;1.26475548100000,1.19292472200000,1.03820951400000,0.963640781000000;1.13066394600000,1.16615664500000,0.918060918000000,0.951829167000000;1.11197984500000,0.985472772000000,0.829496180000000,0.913722002000000;1.07412339100000,1.09465020600000,0.815632965000000,0.892406129000000;1.03696270300000,0.987570237000000,0.911829358000000,0.871442277000000];
H1SPS=[53.8390379300000,53.9581437700000,53.3998186800000,53.7931034500000;15.6779661000000,11.4285714300000,15.6872721100000,10.9684757900000;8.51602023600000,8.30933772100000,7.90571015200000,7.53097416800000;7.90614639100000,7.85708378100000,7.27584727600000,7.17596424400000;7.67092346500000,7.26361396700000,6.91107029300000,6.90547424600000;7.49223257900000,7.54732510300000,6.57604078200000,6.49941067500000;6.97441043700000,7.06623531400000,6.27696816700000,6.38791173600000];

H2CSL=[38.3193931100000,37.8174976500000,36.2211981600000,36.6236162400000;6.95807314900000,5.44019220900000,5.99127570600000,3.98319020600000;2.68456375800000,2.95017089400000,2.84382284400000,2.63206331700000;2.23686838400000,2.65161941500000,2.20321651000000,2.12921502300000;1.89101260700000,2.38846327200000,2.00631618100000,1.99350950400000;2.05505279000000,2.19505418200000,2.01029426000000,2.00956937800000;2.03607787100000,2.17500250600000,1.80647469100000,1.89361499700000];
H1CSL=[53.1997665800000,52.6810912500000,53.7327188900000,53.9667896700000;54.1480820700000,49.3392826500000,52.9689308300000,45.1306413300000;34.9203020100000,33.6391437300000,35.8974359000000,32.8547763700000;30.7569402800000,28.8099825700000,28.3536301900000,26.9578726100000;25.6201708000000,25.6872465100000,24.8002972300000,24.3857209100000;24.7926093500000,24.4512364500000,23.5019908700000,23.4449760800000;22.5933202400000,24.4562493700000,21.9996422800000,21.0295936800000];

%these values were first extrapolated using this code and after all the
%values were extrapolated they where used here to generate the figures.
%the "allvals" variable is the normalized data set in the order as they
%appear above
c1c2=[0.220450000000000,0.0106000000000000;0.316868000000000,0.0185310000000000;0.0667840000000000,0.0426470000000000;0.306492000000000,0.0161460000000000;0.0694270000000000,0.0492610000000000;0.131902000000000,0.0331010000000000;0.0577540000000000,0.0384640000000000;0.368809000000000,0.00623300000000000];
allvals=[1,1,1,1,0.663181464071331,0.580959387609766,0.595787601383108,0.534272838021159,0.481873169607430,0.445620880082340,0.425672084459845,0.396379577520995,0.383549208368032,0.362534752968212,0.363809705319221,0.323078390277405,0.327096574431402,0.315621392247329,0.293758746807755,0.275946546651875,0.282160561914932,0.274459462138023,0.252619649829075,0.318046391812285,0.175142548194686,0.181382282330462,0.192906963387755,0.150966938906313;1,1,1,1,0.624759975985896,0.528159964088331,0.528212879799434,0.462466725715948,0.425166596802307,0.415529301423047,0.374530732551688,0.354366273844825,0.377552543940334,0.380054374971525,0.333877886812191,0.313554537511446,0.367526782753239,0.352549153808838,0.311176877886193,0.292374713345688,0.337809064876234,0.323843859886738,0.287102785847851,0.362767831997163,0.306825376253908,0.318989498129461,0.306394988391872,0.248624866038230;1,1,1,1,0.150423502548728,0.154113060459313,0.132644828423259,0.112352302266564,0.0912740653094290,0.100281429362838,0.0719177068819026,0.0666826801730438,0.0783727818686375,0.0810780033012474,0.0622898278222663,0.0603107812119977,0.0648205613562870,0.0898711965907817,0.0591448156599604,0.0422313029955713,0.0656767140082377,0.0801713956236840,0.0546720126414115,0.0540321160369652,0.0633179114461034,0.0747543246283171,0.0518419695125789,0.0534270403054906;1,1,1,1,0.667404204624613,0.547801244811098,0.632929873298437,0.501511714378410,0.422182007157312,0.400573202762426,0.365453766024887,0.348452776242974,0.375350250941910,0.359325007140983,0.303351776664661,0.306845636174280,0.346889319800217,0.343515937324421,0.313248212571906,0.304742296043836,0.354869271494305,0.342906518171680,0.287474950987795,0.314573886664984,0.327466680064832,0.323165058039987,0.275932274936045,0.286779604590200;1,1,1,1,0.138803287152234,0.105016722419771,0.130942084280755,0.0942476437716591,0.0828606469855627,0.0775754005838256,0.0789755237111511,0.0707483104787221,0.0740756197512057,0.0758346836233688,0.0698359443061221,0.0698811286916877,0.0728515280429970,0.0640848861981695,0.0630989163059232,0.0670833874648312,0.0703713567228150,0.0711846495118719,0.0620443558822501,0.0655184246375378,0.0679367686175521,0.0642212834783875,0.0693619159834174,0.0639793063899820;1,1,1,1,0.291200710539888,0.211804384500605,0.293770138134859,0.203901152499875,0.158175564858204,0.153995989121106,0.148047509287910,0.139998878759615,0.146847839318365,0.145614419474682,0.136252284293337,0.133399335300853,0.142478836174107,0.134615712467086,0.129421231454264,0.128370995594604,0.139159852535649,0.139873697938368,0.123147249270772,0.120822377928820,0.129541884572082,0.130957716857724,0.117546619486012,0.118749641242348;1,1,1,1,0.181580985090920,0.143853838753395,0.165407993394772,0.108760155739334,0.0700575750324037,0.0780107378151711,0.0785126662966248,0.0718679253231494,0.0583743165654744,0.0701162049255789,0.0608267153468454,0.0581377603196511,0.0493487097139467,0.0631576233336528,0.0553906630072670,0.0544323501790822,0.0536295756068147,0.0580433481431049,0.0555004903791399,0.0548708616000942,0.0531343976444307,0.0575131259643246,0.0498734106757113,0.0517047520537257;1,1,1,1,1.01782555734665,0.936565311752156,0.985785419465492,0.836266926492535,0.656399534337957,0.638543031889075,0.668074064398047,0.608796198011828,0.578140511833802,0.546875204867743,0.527679052460470,0.499527075352155,0.481584270890987,0.487598982870348,0.461549270952963,0.451865324195038,0.466028536285356,0.464136863338039,0.437386965623544,0.434433402901359,0.424688334036672,0.464232019301612,0.409427304898474,0.389676573474043];

yValN=NCM1CSL';

xValTime=[0,60,120,180,240,300,600];

xVal=zeros(1,7*4);
NormYmat=zeros(4,7);

for i=1:4
    NormYmat(i,:)=yValN(i,:)./yValN(i,1);
end

%in order to fit all the 4 repeats at once then they are rearranged so they
%will act as one data set
for i=1:7
    yVal( (1:4)+ 4*(i-1))=NormYmat(1:4,i);
    xVal((1:4)+ 4*(i-1))=xValTime(i);
end


 NormY=yVal;


fo = fitoptions('Method','NonlinearLeastSquares',...
                'Lower',[0,0],...
                'Upper',[1,1],...
               'StartPoint',[0.001,0.001]);
           
fnc=@(c1,c2,x)((1-c1)*( exp(-x*c2) )+c1);

[tempfit,gdns] = fit(xVal',NormY',fnc,fo);

fitval=coeffvalues(tempfit);
y50=(1+fitval(1))./2;
 ci= confint(tempfit);
 halflifeerr=log(2)./(ci(:,2));
 halflife=log(2)./fitval(2);
x=[fitval(1),fitval(2),halflife,halflifeerr'];



% NCM 
figure
plot(1:600,fnc(c1c2(1,1),c1c2(1,2),1:600),'-','LineWidth',2,'color',[0.0 0.0 0.8],'DisplayName','*')
set(gca,'FontSize',20)
axis ([0 600 0 1])
yticks(0:0.2:1)
xticks(0:200:600)
hold on
plot(xVal,allvals(1,:),'k*','MarkerSize',5,'color',[0.0 0.0 0.8],'DisplayName','*');
plot(1:600,fnc(c1c2(3,1),c1c2(3,2),1:600),'-','LineWidth',2,'color',[0 0.85 0.0],'DisplayName','*')
plot(xVal,allvals(3,:),'*','MarkerSize',5,'color',[0 0.7 0.0],'DisplayName','*')
hold off;

% H 
figure
plot(1:600,fnc(c1c2(5,1),c1c2(5,2),1:600),'-','LineWidth',2,'color',[0.0 0.0 0.8],'DisplayName','*')
set(gca,'FontSize',20)
axis ([0 600 0 1])
yticks(0:0.2:1)
xticks(0:200:600)
hold on
plot(xVal,allvals(5,:),'k*','MarkerSize',5,'color',[0.0 0.0 0.8],'DisplayName','*');
plot(1:600,fnc(c1c2(7,1),c1c2(7,2),1:600),'-','LineWidth',2,'color',[0 0.85 0.0],'DisplayName','*')
plot(xVal,allvals(7,:),'*','MarkerSize',5,'color',[0 0.7 0.0],'DisplayName','*')
hold off;

% NCM 
figure
plot(1:600,fnc(c1c2(1,1),c1c2(1,2),1:600),'-','LineWidth',2,'color',[0.0 0.0 0.0],'DisplayName','*')
set(gca,'FontSize',20)
axis ([0 600 0 1])
yticks(0:0.2:1)
xticks(0:200:600)
hold on
plot(xVal,allvals(1,:),'k*','MarkerSize',5,'color',[0.0 0.0 0.0],'DisplayName','*');
plot(1:600,fnc(c1c2(3,1),c1c2(3,2),1:600),'-','LineWidth',2,'color',[0 0.85 0.0],'DisplayName','*')
plot(xVal,allvals(3,:),'*','MarkerSize',5,'color',[0 0.7 0.0],'DisplayName','*')
plot(1:600,fnc(c1c2(5,1),c1c2(5,2),1:600),'-','LineWidth',2,'color',[0.8 0.0 0.0],'DisplayName','*')
plot(xVal,allvals(5,:),'*','MarkerSize',5,'color',[0.8 0.0 0.0],'DisplayName','*')
plot(1:600,fnc(c1c2(7,1),c1c2(7,2),1:600),'-','LineWidth',2,'color',[0.0 0.0 0.8],'DisplayName','*')
plot(xVal,allvals(7,:),'*','MarkerSize',5,'color',[0 0.0 0.8],'DisplayName','*')
hold off;


